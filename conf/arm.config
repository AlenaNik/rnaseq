process {

    //
    // Apply software overrides for ARM compatibility
    //

    //// Tested, working, module updates in progress on main dev branch

    withName: 'CUSTOM_GETCHROMSIZES' {
        conda = 'bioconda::samtools=1.21'
        //conda = 'bioconda::samtools=1.20 bioconda::htslib=1.20'
    }

    withName: 'CUSTOM_TX2GENE' {
        conda = 'python=3.13.0'
        //conda = 'python=3.9.5'
    }

    withName: 'SALMON_INDEX|SALMON_QUANT' {
        conda = 'bioconda::salmon=1.10.3'
        //conda = 'bioconda::salmon=1.10.1'
    }

    withName: 'SAMTOOLS_FLAGSTAT|SAMTOOLS_IDXSTATS|SAMTOOLS_INDEX|SAMTOOLS_SORT|SAMTOOLS_STATS' {
        conda = 'bioconda::samtools=1.21 bioconda::htslib'
        //conda = 'bioconda::samtools=1.20 bioconda::htslib'
    }

    withName: 'TRIMGALORE' {
        conda = 'bioconda::trim-galore=0.6.10 bioconda::cutadapt=4.9'
        //conda = 'bioconda::trim-galore=0.6.7 bioconda::cutadapt=3.4'
    }

    withName: 'STRINGTIE_STRINGTIE' {
        conda = 'bioconda::stringtie=2.2.3'
        //conda = 'bioconda::stringtie=2.2.1'
    }

    withName: 'SUBREAD_FEATURECOUNTS' {
        conda = 'bioconda::subread=2.0.6'
        //conda = 'bioconda::subread=2.0.1'
    }

    withName: 'UCSC_BEDGRAPHTOBIGWIG' {
        conda = 'bioconda::ucsc-bedgraphtobigwig=469'
        //conda = 'bioconda::ucsc-bedgraphtobigwig=445'
    }

    //// Untested, but have aarch conda builds in bioconda/ conda-forge channels.
    //// Should update the nf-core modules

    withName: 'BBSPLIT' {
        conda = 'bioconda::bbmap=39.10'
        // conda = 'bioconda::bbmap=39.01'
    }

    withName: 'CAT_FASTQ' {
        conda = 'conda-forge::coreutils=9.5'
        //conda = 'conda-forge::coreutils=8.30'
    }

    withName: 'CAT_ADDITIONAL_FASTA' {
        conda = 'python=3.13.0'
        //conda = 'conda-forge::coreutils=3.9.5'
    }

    withName: 'FQ_SUBSAMPLE' {
        conda = 'bioconda::fq=0.12.0'
        //conda = 'bioconda::fq=0.9.1'
    }
 
    withName: 'KALLISTO_INDEX|KALLISTO_QUANT' {
        conda = 'bioconda::kallisto=0.51.1'
        //conda = 'bioconda::kallisto=0.48.0'
    }

    withName: 'PRESEQ_LCEXTRAP' {
        conda = 'bioconda::preseq=3.2.0'
        //conda = 'bioconda::preseq=3.1.2'
    }

    withName: 'SORTMERNA' {
        conda = 'bioconda::sortmerna=4.3.7'
        //conda = 'bioconda::sortmerna=4.3.6'
    }
    
    withName: 'STAR_ALIGN|STAR_GENOMEGENERATE' {
        conda = 'seqera::star2.7.11b bioconda::samtools=1.21 bioconda::htslib=1.21 conda-forge::gawk=5.1.0'
        //conda = 'bioconda::star=2.7.10a bioconda::samtools=1.18 bioconda::htslib=1.18 conda-forge::gawk=5.1.0'
    }

    //// No longer necessary- dev branch version has an aarch 64 build (s)

    //withName: 'GUNZIP' {
    //    conda = 'conda-forge::sed'
    //    //conda = 'conda-forge::grep=3.11 conda-forge::sed=4.8 conda-forge::tar=1.34'
    //}

    //withName: 'UNTAR' {
    //    conda = 'conda-forge::grep conda-forge::sed conda-forge::tar'
    //    //conda = 'conda-forge::grep=3.11 conda-forge::sed=4.8 conda-forge::tar=1.34'
    //}

    //withName: 'FASTP' {
    //    conda = 'bioconda::fastp'
    //    //conda = 'bioconda::fastp=0.23.4'
    //}

    //withName: 'GFFREAD' {
    //    conda = 'bioconda::gffread'
    //    //conda = 'bioconda::gffread=0.12.7'
    //}

    //withName: 'UMITOOLS_DEDUP|UMITOOLS_EXTRACT|UMITOOLS_PREPAREFORRSEM' {
    //    conda = 'bioconda::umi_tools'
    //    //conda = 'bioconda::umi_tools=1.1.5'
    //}

    //// No aarch64 builds in bioconda / conda-forge channels

    //// a) have seqera aarch64 conda builds
    
    withName: '.*:ALIGN_STAR:STAR_ALIGN_IGENOMES' {
        conda = 'seqera::star=2.6.1d bioconda::samtools=1.21 conda-forge::gawk=5.1.0'
        //conda = 'seqera::star=2.6.1d bioconda::samtools=1.10 conda-forge::gawk=5.1.0'
    }

    withName: 'STAR_GENOMEGENERATE_IGENOMES' {
        conda = 'seqera::star=2.6.1d bioconda::samtools=1.21 conda-forge::gawk=5.1.0'
        //conda = 'bioconda::star=2.6.1d bioconda::samtools=1.10 conda-forge::gawk=5.1.0'
    }

    withName: 'RSEM_PREPAREREFERENCE' {
        conda = 'seqera::rsem=1.3.3 seqera::star=2.6.1d'
        //conda = 'bioconda::rsem=1.3.3 bioconda::star=2.7.10a'
    }

    withName: 'RSEM_CALCULATEEXPRESSION' {
        conda = 'seqera::rsem=1.3.3 seqera::star=2.6.1d'
        //conda = 'bioconda::rsem=1.3.3 bioconda::star=2.7.10a'
    }

    // NOTE THE OLDER STAR VERSION HERE!

    //// b) need aarch64 conda builds

    //withName: 'HISAT2_ALIGN' {
    //    conda = 'bioconda::hisat2 bioconda::samtools'
    //    //conda = 'bioconda::hisat2=2.2.1 bioconda::samtools=1.16.1'
    //}

    //withName: 'HISAT2_BUILD|HISAT2_EXTRACTSPLICESITES' {
    //    conda = 'bioconda::hisat2'
    //    //conda = 'bioconda::hisat2=2.2.1'
    //}

}
